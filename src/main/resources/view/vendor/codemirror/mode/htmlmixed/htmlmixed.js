!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../xml/xml"),require("../javascript/javascript"),require("../css/css")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../javascript/javascript","../css/css"],t):t(CodeMirror)}(function(CodeMirror){"use strict";CodeMirror.defineMode("htmlmixed",function(t,e){function a(t,e){var a=e.htmlState.tagName;a&&(a=a.toLowerCase());var o=c.token(t,e.htmlState);if("script"==a&&/\btag\b/.test(o)&&">"==t.current()){var i=t.string.slice(Math.max(0,t.pos-100),t.pos).match(/\btype\s*=\s*("[^"]+"|'[^']+'|\S+)[^<]*$/i);i=i?i[1]:"",i&&/[\"\']/.test(i.charAt(0))&&(i=i.slice(1,i.length-1));for(var m=0;m<s.length;++m){var d=s[m];if("string"==typeof d.matches?i==d.matches:d.matches.test(i)){d.mode&&(e.token=l,e.localMode=d.mode,e.localState=d.mode.startState&&d.mode.startState(c.indent(e.htmlState,"")));break}}}else"style"==a&&/\btag\b/.test(o)&&">"==t.current()&&(e.token=n,e.localMode=r,e.localState=r.startState(c.indent(e.htmlState,"")));return o}function o(t,e,a){var o,l=t.current(),n=l.search(e);return n>-1?t.backUp(l.length-n):(o=l.match(/<\/?$/))&&(t.backUp(l.length),t.match(e,!1)||t.match(l)),a}function l(t,e){return t.match(/^<\/\s*script\s*>/i,!1)?(e.token=a,e.localState=e.localMode=null,null):o(t,/<\/\s*script\s*>/,e.localMode.token(t,e.localState))}function n(t,e){return t.match(/^<\/\s*style\s*>/i,!1)?(e.token=a,e.localState=e.localMode=null,null):o(t,/<\/\s*style\s*>/,r.token(t,e.localState))}var c=CodeMirror.getMode(t,{name:"xml",htmlMode:!0,multilineTagIndentFactor:e.multilineTagIndentFactor,multilineTagIndentPastTag:e.multilineTagIndentPastTag}),r=CodeMirror.getMode(t,"css"),s=[],i=e&&e.scriptTypes;if(s.push({matches:/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^$/i,mode:CodeMirror.getMode(t,"javascript")}),i)for(var m=0;m<i.length;++m){var d=i[m];s.push({matches:d.matches,mode:d.mode&&CodeMirror.getMode(t,d.mode)})}return s.push({matches:/./,mode:CodeMirror.getMode(t,"text/plain")}),{startState:function(){var t=c.startState();return{token:a,localMode:null,localState:null,htmlState:t}},copyState:function(t){if(t.localState)var e=CodeMirror.copyState(t.localMode,t.localState);return{token:t.token,localMode:t.localMode,localState:e,htmlState:CodeMirror.copyState(c,t.htmlState)}},token:function(t,e){return e.token(t,e)},indent:function(t,e){return!t.localMode||/^\s*<\//.test(e)?c.indent(t.htmlState,e):t.localMode.indent?t.localMode.indent(t.localState,e):CodeMirror.Pass},innerMode:function(t){return{state:t.localState||t.htmlState,mode:t.localMode||c}}}},"xml","javascript","css"),CodeMirror.defineMIME("text/html","htmlmixed")});