!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../python/python"),require("../stex/stex"),require("../../addon/mode/overlay")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../python/python","../stex/stex","../../addon/mode/overlay"],e):e(CodeMirror)}(function(CodeMirror){"use strict";CodeMirror.defineMode("rst",function(e,t){var a=/^\*\*[^\*\s](?:[^\*]*[^\*\s])?\*\*/,c=/^\*[^\*\s](?:[^\*]*[^\*\s])?\*/,n=/^``[^`\s](?:[^`]*[^`\s])``/,r=/^(?:[\d]+(?:[\.,]\d+)*)/,m=/^(?:\s\+[\d]+(?:[\.,]\d+)*)/,o=/^(?:\s\-[\d]+(?:[\.,]\d+)*)/,s="[Hh][Tt][Tt][Pp][Ss]?://",h="(?:[\\d\\w.-]+)\\.(?:\\w{2,6})",l="(?:/[\\d\\w\\#\\%\\&\\-\\.\\,\\/\\:\\=\\?\\~]+)*",i=new RegExp("^"+s+h+l),p={token:function(e){if(e.match(a)&&e.match(/\W+|$/,!1))return"strong";if(e.match(c)&&e.match(/\W+|$/,!1))return"em";if(e.match(n)&&e.match(/\W+|$/,!1))return"string-2";if(e.match(r))return"number";if(e.match(m))return"positive";if(e.match(o))return"negative";if(e.match(i))return"link";for(;!(null==e.next()||e.match(a,!1)||e.match(c,!1)||e.match(n,!1)||e.match(r,!1)||e.match(m,!1)||e.match(o,!1)||e.match(i,!1)););return null}},d=CodeMirror.getMode(e,t.backdrop||"rst-base");return CodeMirror.overlayMode(d,p,!0)},"python","stex"),CodeMirror.defineMode("rst-base",function(e){function t(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,a){return"undefined"!=typeof t[a]?t[a]:e})}function a(e,t){var n=null;if(e.sol()&&e.match(U,!1))h(t,o,{mode:p,local:CodeMirror.startState(p)});else if(e.sol()&&e.match(v))h(t,c),n="meta";else if(e.sol()&&e.match(_))h(t,a),n="header";else if(i(t)==H||e.match(H,!1))switch(l(t)){case 0:h(t,a,s(H,1)),e.match(/^:/),n="meta";break;case 1:h(t,a,s(H,2)),e.match(w),n="keyword",e.current().match(/^(?:math|latex)/)&&(t.tmp_stex=!0);break;case 2:h(t,a,s(H,3)),e.match(/^:`/),n="meta";break;case 3:if(t.tmp_stex&&(t.tmp_stex=void 0,t.tmp={mode:d,local:CodeMirror.startState(d)}),t.tmp){if("`"==e.peek()){h(t,a,s(H,4)),t.tmp=void 0;break}n=t.tmp.mode.token(e,t.tmp.local);break}h(t,a,s(H,4)),e.match(y),n="string";break;case 4:h(t,a,s(H,5)),e.match(/^`/),n="meta";break;case 5:h(t,a,s(H,6)),e.match(x);break;default:h(t,a)}else if(i(t)==P||e.match(P,!1))switch(l(t)){case 0:h(t,a,s(P,1)),e.match(/^`/),n="meta";break;case 1:h(t,a,s(P,2)),e.match(y),n="string";break;case 2:h(t,a,s(P,3)),e.match(/^`:/),n="meta";break;case 3:h(t,a,s(P,4)),e.match(w),n="keyword";break;case 4:h(t,a,s(P,5)),e.match(/^:/),n="meta";break;case 5:h(t,a,s(P,6)),e.match(x);break;default:h(t,a)}else if(i(t)==z||e.match(z,!1))switch(l(t)){case 0:h(t,a,s(z,1)),e.match(/^:/),n="meta";break;case 1:h(t,a,s(z,2)),e.match(w),n="keyword";break;case 2:h(t,a,s(z,3)),e.match(/^:/),n="meta";break;case 3:h(t,a,s(z,4)),e.match(x);break;default:h(t,a)}else if(i(t)==T||e.match(T,!1))switch(l(t)){case 0:h(t,a,s(T,1)),e.match(F),n="variable-2";break;case 1:h(t,a,s(T,2)),e.match(/^_?_?/)&&(n="link");break;default:h(t,a)}else if(e.match(j))h(t,a),n="quote";else if(e.match(I))h(t,a),n="quote";else if(e.match(A))h(t,a),e.peek()&&!e.peek().match(/^\W$/)||(n="link");else if(i(t)==C||e.match(C,!1))switch(l(t)){case 0:!e.peek()||e.peek().match(/^\W$/)?h(t,a,s(C,1)):e.match(C);break;case 1:h(t,a,s(C,2)),e.match(/^`/),n="link";break;case 2:h(t,a,s(C,3)),e.match(y);break;case 3:h(t,a,s(C,4)),e.match(/^`_/),n="link";break;default:h(t,a)}else e.match(Q)?h(t,r):e.next()&&h(t,a);return n}function c(e,t){var r=null;if(i(t)==M||e.match(M,!1))switch(l(t)){case 0:h(t,c,s(M,1)),e.match(F),r="variable-2";break;case 1:h(t,c,s(M,2)),e.match(G);break;case 2:h(t,c,s(M,3)),e.match(J),r="keyword";break;case 3:h(t,c,s(M,4)),e.match(K),r="meta";break;default:h(t,a)}else if(i(t)==S||e.match(S,!1))switch(l(t)){case 0:h(t,c,s(S,1)),e.match(B),r="keyword",e.current().match(/^(?:math|latex)/)?t.tmp_stex=!0:e.current().match(/^python/)&&(t.tmp_py=!0);break;case 1:h(t,c,s(S,2)),e.match(D),r="meta",(e.match(/^latex\s*$/)||t.tmp_stex)&&(t.tmp_stex=void 0,h(t,o,{mode:d,local:CodeMirror.startState(d)}));break;case 2:h(t,c,s(S,3)),(e.match(/^python\s*$/)||t.tmp_py)&&(t.tmp_py=void 0,h(t,o,{mode:p,local:CodeMirror.startState(p)}));break;default:h(t,a)}else if(i(t)==$||e.match($,!1))switch(l(t)){case 0:h(t,c,s($,1)),e.match(L),e.match(N),r="link";break;case 1:h(t,c,s($,2)),e.match(O),r="meta";break;default:h(t,a)}else e.match(W)?(h(t,a),r="quote"):e.match(q)?(h(t,a),r="quote"):(e.eatSpace(),e.eol()?h(t,a):(e.skipToEnd(),h(t,n),r="comment"));return r}function n(e,t){return m(e,t,"comment")}function r(e,t){return m(e,t,"meta")}function m(e,t,c){return e.eol()||e.eatSpace()?(e.skipToEnd(),c):(h(t,a),null)}function o(e,t){return t.ctx.mode&&t.ctx.local?e.sol()?(e.eatSpace()||h(t,a),null):t.ctx.mode.token(e,t.ctx.local):(h(t,a),null)}function s(e,t,a,c){return{phase:e,stage:t,mode:a,local:c}}function h(e,t,a){e.tok=t,e.ctx=a||{}}function l(e){return e.ctx.stage||0}function i(e){return e.ctx.phase}var p=CodeMirror.getMode(e,"python"),d=CodeMirror.getMode(e,"stex"),u="\\s+",f="(?:\\s*|\\W|$)",x=new RegExp(t("^{0}",f)),k="(?:[^\\W\\d_](?:[\\w!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",w=new RegExp(t("^{0}",k)),b="(?:[^\\W\\d_](?:[\\w\\s!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",g=t("(?:{0}|`{1}`)",k,b),E="(?:[^\\s\\|](?:[^\\|]*[^\\s\\|])?)",R="(?:[^\\`]+)",y=new RegExp(t("^{0}",R)),_=new RegExp("^([!'#$%&\"()*+,-./:;<=>?@\\[\\\\\\]^_`{|}~])\\1{3,}\\s*$"),v=new RegExp(t("^\\.\\.{0}",u)),$=new RegExp(t("^_{0}:{1}|^__:{1}",g,f)),S=new RegExp(t("^{0}::{1}",g,f)),M=new RegExp(t("^\\|{0}\\|{1}{2}::{3}",E,u,g,f)),W=new RegExp(t("^\\[(?:\\d+|#{0}?|\\*)]{1}",g,f)),q=new RegExp(t("^\\[{0}\\]{1}",g,f)),T=new RegExp(t("^\\|{0}\\|",E)),j=new RegExp(t("^\\[(?:\\d+|#{0}?|\\*)]_",g)),I=new RegExp(t("^\\[{0}\\]_",g)),A=new RegExp(t("^{0}__?",g)),C=new RegExp(t("^`{0}`_",R)),H=new RegExp(t("^:{0}:`{1}`{2}",k,R,f)),P=new RegExp(t("^`{1}`:{0}:{2}",k,R,f)),z=new RegExp(t("^:{0}:{1}",k,f)),B=new RegExp(t("^{0}",g)),D=new RegExp(t("^::{0}",f)),F=new RegExp(t("^\\|{0}\\|",E)),G=new RegExp(t("^{0}",u)),J=new RegExp(t("^{0}",g)),K=new RegExp(t("^::{0}",f)),L=new RegExp("^_"),N=new RegExp(t("^{0}|_",g)),O=new RegExp(t("^:{0}",f)),Q=new RegExp("^::\\s*$"),U=new RegExp("^\\s+(?:>>>|In \\[\\d+\\]:)\\s");return{startState:function(){return{tok:a,ctx:s(void 0,0)}},copyState:function(e){var t=e.ctx,a=e.tmp;return t.local&&(t={mode:t.mode,local:CodeMirror.copyState(t.mode,t.local)}),a&&(a={mode:a.mode,local:CodeMirror.copyState(a.mode,a.local)}),{tok:e.tok,ctx:t,tmp:a}},innerMode:function(e){return e.tmp?{state:e.tmp.local,mode:e.tmp.mode}:e.ctx.mode?{state:e.ctx.local,mode:e.ctx.mode}:null},token:function(e,t){return t.tok(e,t)}}},"python","stex"),CodeMirror.defineMIME("text/x-rst","rst")});