(function(){var e,n=[].indexOf||function(e){for(var n=0,r=this.length;n<r;n++)if(n in this&&this[n]===e)return n;return-1};e=angular.module("angularBootstrapNavTree",[]),e.directive("dtpAbnTree",["$timeout",function(e){return{restrict:"E",template:'<ul class="nav nav-list nav-pills nav-stacked abn-tree">\n <li ng-repeat="row in tree_rows | filter:{visible:true} track by row.branch.uid" ng-animate="\'abn-tree-animate\'" ng-class="\'level-\' + {{ row.level }} + (row.branch.selected ? \' active\':\'\') + \' \' +row.classes.join(\' \')" class="abn-tree-row row" ><a ng-style="{\'color\': showColor(row.branch)}" ng-click="user_clicks_branch(row.branch)" ng-dblclick="update_tree_data(row.branch)" data-toggle="context" data-target="#caseTreeMenu" ><i ng-class="row.checkbox_icon" ng-if=\'checkboxShow\' class="indented" ng-click="checkboxSet(row.branch)"></i><i ng-class="row.tree_icon" ng-click="update_tree_data(row.branch)" class="indented tree-icon"></i><span class="indented tree-label" tooltip="{{row.branch.type == -1 ? row.branch.description : \'\'}}">{{ row.label }}</span><span style="margin-left: 10px;" ng-if="row.branch.type == -1" class="indented" tooltip="{{row.branch.dataNum}}组数据">{{ \'(\' + row.branch.dataNum + \')\' }}</span></a></li>\n</ul>',replace:!0,scope:{treeData:"=",onSelect:"&",updateTree:"&",initialSelection:"@",treeControl:"=",selectedBranch:"=",checkboxShow:"="},link:function(r,t,l){var c,a,i,o,u,h,d,s,f,_,b;if(c=function(e){},null==l.iconExpand&&(l.iconExpand="fa-plus-square-o glyphicon"),null==l.iconCollapse&&(l.iconCollapse="fa-minus-square-o glyphicon"),null==l.iconLeaf&&(l.iconLeaf="fa-file-text glyphicon"),null==l.partChecked&&(l.partChecked="fa-check-square glyphicon"),null==l.wholeChecked&&(l.wholeChecked="fa-check-square-o glyphicon"),null==l.noneChecked&&(l.noneChecked="fa-square-o glyphicon"),null==l.expandLevel&&(l.expandLevel="3"),i=parseInt(l.expandLevel,10),!r.treeData)return void alert("no treeData defined for the tree!");if(null==r.treeData.length){if(null==treeData.label)return void alert("treeData should be an array of root branches");r.treeData=[treeData]}u=function(e){var n,t,l,c,a,i;for(n=function(r,t){var l,c,a,i,o;if(e(r,t),null!=r.children){for(i=r.children,o=[],c=0,a=i.length;c<a;c++)l=i[c],o.push(n(l,t+1));return o}},a=r.treeData,i=[],l=0,c=a.length;l<c;l++)t=a[l],i.push(n(t,1));return i},_=null,f=function(n){if(!n)return null!=_&&(_.selected=!1),void(_=null);if(n!==_){if(null!=_&&(_.selected=!1),n.selected=!0,_=n,a(n),null!=n.onSelect)return e(function(){return n.onSelect(n)});if(null!=r.onSelect)return e(function(){return r.onSelect({branch:n})})}},r.user_clicks_branch=function(e){if(e!==_)return f(e)},r.update_tree_data=function(e){e.expanded=!e.expanded,r.updateTree({branch:e})};var g=function(e){var n=h(e),r=0;if(null!=n){for(var t=0;t<n.children.length;t++)1==n.children[t].allotted&&r++;n.children.length==r&&(n.allotted=!0),g(n)}};r.showColor=function(e){return e.allotted?"#ADAAAA":"#656565"},r.checkboxSet=function(e){"whole"==e.checkbox?e.checkbox="none":e.checkbox="whole",p(e,e.checkbox),v(e)};var p=function(e,n){if(null!=e.children)for(var r=0;r<e.children.length;r++)e.children[r].checkbox=n,null!=e.children[r].children&&p(e.children[r],n)},v=function(e){var n=h(e),r=0,t=0,l=0;if(null!=n){for(var c=0;c<n.children.length;c++)"part"==n.children[c].checkbox?t++:"whole"==n.children[c].checkbox?l++:"none"==n.children[c].checkbox&&r++;n.children.length==l?n.checkbox="whole":n.children.length==r?n.checkbox="none":n.checkbox="part",v(n)}};return h=function(e){var n;return n=void 0,e.parent_uid&&u(function(r){if(r.uid===e.parent_uid)return n=r}),n},o=function(e,n){var r;if(r=h(e),null!=r)return n(r),o(r,n)},a=function(e){return o(e,function(e){return e.expanded=!0})},r.tree_rows=[],r.selectedBranch=[],s=function(){var e,t,c,a,i,o;for(u(function(e,n){if(!e.uid)return e.uid=""+Math.random()}),u(function(e){var n,r,t,l,c;if(angular.isArray(e.children)){for(l=e.children,c=[],r=0,t=l.length;r<t;r++)n=l[r],c.push(n.parent_uid=e.uid);return c}}),r.tree_rows=[],r.selectedBranch=[],u(function(e){var n,r;return e.children?e.children.length>0?(r=function(e){return"string"==typeof e?{label:e,children:[]}:e},e.children=function(){var t,l,c,a;for(c=e.children,a=[],t=0,l=c.length;t<l;t++)n=c[t],a.push(r(n));return a}()):void 0:e.children=[]}),e=function(t,c,a){var i,o,u,h,d,s,f,_;if(null==c.expanded&&(c.expanded=!1),null==c.classes&&(c.classes=[]),null==c.checkbox&&(c.checkbox="none"),"part"==c.checkbox?h=l.partChecked:"whole"==c.checkbox?h=l.wholeChecked:"none"==c.checkbox&&(h=l.noneChecked),c.noLeaf||c.children&&0!==c.children.length||c.type!=-1?u=c.expanded?l.iconCollapse:l.iconExpand:(u=l.iconLeaf,n.call(c.classes,"leaf")<0&&c.classes.push("leaf")),r.tree_rows.push({level:t,branch:c,label:c.label,classes:c.classes,tree_icon:u,checkbox_icon:h,visible:a}),"none"!=c.checkbox&&r.selectedBranch.push({id:c.id,label:c.label,checkbox:c.checkbox,type:c.type}),null!=c.children){for(f=c.children,_=[],d=0,s=f.length;d<s;d++)i=f[d],o=a&&c.expanded,_.push(e(t+1,i,o));return _}},i=r.treeData,o=[],c=0,a=i.length;c<a;c++)t=i[c],o.push(e(1,t,!0));return o},r.$watch("treeData",s,!0),null!=l.initialSelection&&u(function(n){if(n.label===l.initialSelection)return e(function(){return f(n)})}),d=r.treeData.length,u(function(e,n){return e.level=n,e.expanded=e.level<i}),null!=r.treeControl&&angular.isObject(r.treeControl)?(b=r.treeControl,b.setBranchNoneChecked=function(){return u(function(e){return e.checkbox="none"})},b.setNewAllottedBranch=function(e,n){return s(),u(function(r){if(r.type==-1)for(var t=0;t<e.length;t++)e[t].case_id==r.id&&(r.allotPerson="  ("+e[t].duty_person+")",r.allotted=!0,g(r));else if(null!=n)for(var t=0;t<n.length;t++)"whole"==n[t].checkbox&&n[t].id==r.id&&(r.allotted=!0,g(r));else if(0==r.allotted){var l=h(r);null!=l&&1==l.allotted&&(r.allotted=!0)}})},b.check_all=function(){return u(function(e){return e.checkbox="whole"})},b.uncheck_all=function(){return u(function(e){return e.checkbox="none"})},b.expand_all=function(){return u(function(e,n){return e.expanded=!0})},b.expand_module=function(){return u(function(e,n){if(e.children.length>0)for(var r=0;r<e.children.length;r++)if(e.children[r].type!=-1)return e.expanded=!0;return e.expanded=!1})},b.collapse_all=function(){return u(function(e,n){return e.expanded=!1})},b.get_first_branch=function(){if(d=r.treeData.length,d>0)return r.treeData[0]},b.select_first_branch=function(){var e;return e=b.get_first_branch(),b.select_branch(e)},b.get_selected_branch=function(){return _},b.get_parent_branch=function(e){return h(e)},b.select_branch=function(e){return f(e),e},b.get_children=function(e){return e.children},b.select_parent_branch=function(e){var n;if(null==e&&(e=b.get_selected_branch()),null!=e&&(n=b.get_parent_branch(e),null!=n))return b.select_branch(n),n},b.add_branch=function(e,n){return null!=e?(e.children.push(n),e.expanded=!0):r.treeData.push(n),n},b.del_children_branch=function(e){null!=e&&(null!=e.children?b.del_children_branch(e.children):e.length=0)},b.del_curr_branch=function(e,n){if(null!=e){var t,l=b.get_parent_branch(e);t=null!=l?l.children:r.treeData;for(var c=0;c<t.length;c++)if(t[c].label==n){t.splice(c,1);break}}},b.add_root_branch=function(e){return b.add_branch(null,e),e},b.expand_branch=function(e){if(null==e&&(e=b.get_selected_branch()),null!=e)return e.expanded=!0,e},b.collapse_branch=function(e){if(null==e&&(e=_),null!=e)return e.expanded=!1,e},b.get_siblings=function(e){var n,t;if(null==e&&(e=_),null!=e)return n=b.get_parent_branch(e),t=n?n.children:r.treeData},b.get_next_sibling=function(e){var n,r;if(null==e&&(e=_),null!=e&&(r=b.get_siblings(e),d=r.length,n=r.indexOf(e),n<d))return r[n+1]},b.get_branch_index=function(e){var n,r;return null==e&&(e=_),r=b.get_siblings(e),d=r.length,n=r.indexOf(e)},b.get_prev_sibling=function(e){var n,r;if(null==e&&(e=_),r=b.get_siblings(e),d=r.length,n=r.indexOf(e),n>0)return r[n-1]},b.select_next_sibling=function(e){var n;if(null==e&&(e=_),null!=e&&(n=b.get_next_sibling(e),null!=n))return b.select_branch(n)},b.select_prev_sibling=function(e){var n;if(null==e&&(e=_),null!=e&&(n=b.get_prev_sibling(e),null!=n))return b.select_branch(n)},b.get_first_child=function(e){var n;if(null==e&&(e=_),null!=e&&(null!=(n=e.children)?n.length:void 0)>0)return e.children[0]},b.get_closest_ancestor_next_sibling=function(e){var n,r;return n=b.get_next_sibling(e),null!=n?n:(r=b.get_parent_branch(e),b.get_closest_ancestor_next_sibling(r))},b.get_next_branch=function(e){var n;if(null==e&&(e=_),null!=e)return n=b.get_first_child(e),null!=n?n:n=b.get_closest_ancestor_next_sibling(e)},b.select_next_branch=function(e){var n;if(null==e&&(e=_),null!=e&&(n=b.get_next_branch(e),null!=n))return b.select_branch(n),n},b.last_descendant=function(e){var n;return d=e.children.length,0===d?e:(n=e.children[d-1],b.last_descendant(n))},b.get_prev_branch=function(e){var n,r;if(null==e&&(e=_),null!=e)return r=b.get_prev_sibling(e),null!=r?b.last_descendant(r):n=b.get_parent_branch(e)},b.select_prev_branch=function(e){var n;if(null==e&&(e=_),null!=e&&(n=b.get_prev_branch(e),null!=n))return b.select_branch(n),n}):void 0}}}])}).call(this);