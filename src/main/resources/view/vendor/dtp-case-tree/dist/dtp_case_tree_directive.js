(function(){var e,n=[].indexOf||function(e){for(var n=0,r=this.length;n<r;n++)if(n in this&&this[n]===e)return n;return-1};e=angular.module("dtpCaseTree",[]),e.directive("dtpCaseTree",["$timeout",function(e){return{restrict:"E",template:'<ul class="nav nav-list nav-pills nav-stacked abn-tree">\n <li ng-repeat="row in tree_rows | filter:{visible:true} track by row.branch.uid" ng-animate="\'abn-tree-animate\'" ng-class="\'level-\' + {{ row.level }} + (row.branch.selected ? \' active\':\'\') + \' \' +row.classes.join(\' \')" class="abn-tree-row row" ><a ng-style="{\'color\': showColor(row.branch)}" ng-click="user_clicks_branch(row.branch)" ng-dblclick="update_tree_data(row.branch)" ng-right-click="user_right_clicks_branch(row.branch)" data-toggle="context" data-target="#caseTreeMenu" ><i ng-class="row.checkbox_icon" ng-if=\'checkboxShow\' class="indented" ng-click="checkboxSet(row.branch)"></i><i ng-class="row.tree_icon" ng-click="update_tree_data(row.branch)" class="indented tree-icon"></i><span class="indented tree-label" >{{ row.label }}    {{ row.allotPerson}}</span></a></li>\n</ul>',replace:!0,scope:{treeData:"=",onSelect:"&",updateTree:"&",initialSelection:"@",treeControl:"=",selectedBranch:"=",checkboxShow:"="},link:function(r,l,t){var c,a,i,u,o,h,d,s,f,_,b;if(c=function(e){},null==t.iconExpand&&(t.iconExpand="fa-plus-square-o glyphicon"),null==t.iconCollapse&&(t.iconCollapse="fa-minus-square-o glyphicon"),null==t.iconLeaf&&(t.iconLeaf="fa-file-text glyphicon"),null==t.partChecked&&(t.partChecked="fa-check-square glyphicon"),null==t.wholeChecked&&(t.wholeChecked="fa-check-square-o glyphicon"),null==t.noneChecked&&(t.noneChecked="fa-square-o glyphicon"),null==t.expandLevel&&(t.expandLevel="3"),i=parseInt(t.expandLevel,10),!r.treeData)return void alert("no treeData defined for the tree!");if(null==r.treeData.length){if(null==treeData.label)return void alert("treeData should be an array of root branches");r.treeData=[treeData]}o=function(e){var n,l,t,c,a,i;for(n=function(r,l){var t,c,a,i,u;if(e(r,l),null!=r.children){for(i=r.children,u=[],c=0,a=i.length;c<a;c++)t=i[c],u.push(n(t,l+1));return u}},a=r.treeData,i=[],t=0,c=a.length;t<c;t++)l=a[t],i.push(n(l,1));return i},_=null,f=function(n){if(!n)return null!=_&&(_.selected=!1),void(_=null);if(n!==_){if(null!=_&&(_.selected=!1),n.selected=!0,_=n,a(n),null!=n.onSelect)return e(function(){return n.onSelect(n)});if(null!=r.onSelect)return e(function(){return r.onSelect({branch:n})})}},r.user_clicks_branch=function(e){if(e!==_)return f(e)},r.update_tree_data=function(e){e.expanded=!e.expanded,r.updateTree({branch:e})},r.user_right_clicks_branch=function(e){if(e!==_)return f(e)};var g=function(e){var n=h(e),r=0;if(null!=n){for(var l=0;l<n.children.length;l++)1==n.children[l].allotted&&r++;n.children.length==r&&(n.allotted=!0),g(n)}};r.showColor=function(e){return e.allotted?"#ADAAAA":"#656565"},r.checkboxSet=function(e){"whole"==e.checkbox?e.checkbox="none":e.checkbox="whole",p(e,e.checkbox),v(e)};var p=function(e,n){if(null!=e.children)for(var r=0;r<e.children.length;r++)e.children[r].checkbox=n,null!=e.children[r].children&&p(e.children[r],n)},v=function(e){var n=h(e),r=0,l=0,t=0;if(null!=n){for(var c=0;c<n.children.length;c++)"part"==n.children[c].checkbox?l++:"whole"==n.children[c].checkbox?t++:"none"==n.children[c].checkbox&&r++;n.children.length==t?n.checkbox="whole":n.children.length==r?n.checkbox="none":n.checkbox="part",v(n)}};return h=function(e){var n;return n=void 0,e.parent_uid&&o(function(r){if(r.uid===e.parent_uid)return n=r}),n},u=function(e,n){var r;if(r=h(e),null!=r)return n(r),u(r,n)},a=function(e){return u(e,function(e){return e.expanded=!0})},r.tree_rows=[],r.selectedBranch=[],s=function(){var e,l,c,a,i,u;for(o(function(e,n){if(!e.uid)return e.uid=""+Math.random()}),o(function(e){var n,r,l,t,c;if(angular.isArray(e.children)){for(t=e.children,c=[],r=0,l=t.length;r<l;r++)n=t[r],c.push(n.parent_uid=e.uid);return c}}),r.tree_rows=[],r.selectedBranch=[],o(function(e){var n,r;return e.children?e.children.length>0?(r=function(e){return"string"==typeof e?{label:e,children:[]}:e},e.children=function(){var l,t,c,a;for(c=e.children,a=[],l=0,t=c.length;l<t;l++)n=c[l],a.push(r(n));return a}()):void 0:e.children=[]}),e=function(l,c,a){var i,u,o,h,d,s,f,_;if(null==c.expanded&&(c.expanded=!1),null==c.classes&&(c.classes=[]),null==c.checkbox&&(c.checkbox="none"),"part"==c.checkbox?h=t.partChecked:"whole"==c.checkbox?h=t.wholeChecked:"none"==c.checkbox&&(h=t.noneChecked),c.noLeaf||c.children&&0!==c.children.length||c.type!=-1?o=c.expanded?t.iconCollapse:t.iconExpand:(o=t.iconLeaf,n.call(c.classes,"leaf")<0&&c.classes.push("leaf")),r.tree_rows.push({level:l,branch:c,label:c.label,allotPerson:c.allotPerson,classes:c.classes,tree_icon:o,checkbox_icon:h,visible:a}),"none"!=c.checkbox&&r.selectedBranch.push({id:c.id,type:c.type,label:c.label,status:c.checkbox}),null!=c.children){for(f=c.children,_=[],d=0,s=f.length;d<s;d++)i=f[d],u=a&&c.expanded,_.push(e(l+1,i,u));return _}},i=r.treeData,u=[],c=0,a=i.length;c<a;c++)l=i[c],u.push(e(1,l,!0));return u},r.$watch("treeData",s,!0),null!=t.initialSelection&&o(function(n){if(n.label===t.initialSelection)return e(function(){return f(n)})}),d=r.treeData.length,o(function(e,n){return e.level=n,e.expanded=e.level<i}),null!=r.treeControl&&angular.isObject(r.treeControl)?(b=r.treeControl,b.setBranchNoneChecked=function(){return o(function(e){return e.checkbox="none"})},b.setNewAllottedBranch=function(e,n){return s(),o(function(r){if(r.type==-1)for(var l=0;l<e.length;l++)e[l].case_id==r.id&&(r.allotPerson="  ("+e[l].duty_person+")",r.allotted=!0,g(r));else if(null!=n)for(var l=0;l<n.length;l++)"whole"==n[l].status&&n[l].id==r.id&&(r.allotted=!0,g(r));else if(0==r.allotted){var t=h(r);null!=t&&1==t.allotted&&(r.allotted=!0)}})},b.expand_all=function(){return o(function(e,n){return e.expanded=!0})},b.expand_module=function(){return o(function(e,n){if(e.children.length>0)for(var r=0;r<e.children.length;r++)if(e.children[r].type!=-1)return e.expanded=!0;return e.expanded=!1})},b.collapse_all=function(){return o(function(e,n){return e.expanded=!1})},b.get_first_branch=function(){if(d=r.treeData.length,d>0)return r.treeData[0]},b.select_first_branch=function(){var e;return e=b.get_first_branch(),b.select_branch(e)},b.get_selected_branch=function(){return _},b.get_parent_branch=function(e){return h(e)},b.select_branch=function(e){return f(e),e},b.get_children=function(e){return e.children},b.select_parent_branch=function(e){var n;if(null==e&&(e=b.get_selected_branch()),null!=e&&(n=b.get_parent_branch(e),null!=n))return b.select_branch(n),n},b.add_branch=function(e,n){return null!=e?(e.children.push(n),e.expanded=!0):r.treeData.push(n),n},b.del_children_branch=function(e){null!=e&&(null!=e.children?b.del_children_branch(e.children):e.length=0)},b.del_curr_branch=function(e,n){if(null!=e){var l,t=b.get_parent_branch(e);l=null!=t?t.children:r.treeData;for(var c=0;c<l.length;c++)if(l[c].label==n){l.splice(c,1);break}}},b.add_root_branch=function(e){return b.add_branch(null,e),e},b.expand_branch=function(e){if(null==e&&(e=b.get_selected_branch()),null!=e)return e.expanded=!0,e},b.collapse_branch=function(e){if(null==e&&(e=_),null!=e)return e.expanded=!1,e},b.get_siblings=function(e){var n,l;if(null==e&&(e=_),null!=e)return n=b.get_parent_branch(e),l=n?n.children:r.treeData},b.get_next_sibling=function(e){var n,r;if(null==e&&(e=_),null!=e&&(r=b.get_siblings(e),d=r.length,n=r.indexOf(e),n<d))return r[n+1]},b.get_branch_index=function(e){var n,r;return null==e&&(e=_),r=b.get_siblings(e),d=r.length,n=r.indexOf(e)},b.get_prev_sibling=function(e){var n,r;if(null==e&&(e=_),r=b.get_siblings(e),d=r.length,n=r.indexOf(e),n>0)return r[n-1]},b.select_next_sibling=function(e){var n;if(null==e&&(e=_),null!=e&&(n=b.get_next_sibling(e),null!=n))return b.select_branch(n)},b.select_prev_sibling=function(e){var n;if(null==e&&(e=_),null!=e&&(n=b.get_prev_sibling(e),null!=n))return b.select_branch(n)},b.get_first_child=function(e){var n;if(null==e&&(e=_),null!=e&&(null!=(n=e.children)?n.length:void 0)>0)return e.children[0]},b.get_closest_ancestor_next_sibling=function(e){var n,r;return n=b.get_next_sibling(e),null!=n?n:(r=b.get_parent_branch(e),b.get_closest_ancestor_next_sibling(r))},b.get_next_branch=function(e){var n;if(null==e&&(e=_),null!=e)return n=b.get_first_child(e),null!=n?n:n=b.get_closest_ancestor_next_sibling(e)},b.select_next_branch=function(e){var n;if(null==e&&(e=_),null!=e&&(n=b.get_next_branch(e),null!=n))return b.select_branch(n),n},b.last_descendant=function(e){var n;return d=e.children.length,0===d?e:(n=e.children[d-1],b.last_descendant(n))},b.get_prev_branch=function(e){var n,r;if(null==e&&(e=_),null!=e)return r=b.get_prev_sibling(e),null!=r?b.last_descendant(r):n=b.get_parent_branch(e)},b.select_prev_branch=function(e){var n;if(null==e&&(e=_),null!=e&&(n=b.get_prev_branch(e),null!=n))return b.select_branch(n),n}):void 0}}}])}).call(this);